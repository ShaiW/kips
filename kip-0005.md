```
  KIP: 5
  Layer: API/RPC
  Title: Counting Transaction Confirmations Better
  Author: Shai Wyborski <shai.wyborski@mail.huji.ac.il>
  Status: proposed
```

# Motivation
The current interface for counting confirmations of a transaction tx contained in a block B simply counts how many confirmations are above the block. There are two problems with this measure:
1. It disregards competing chain. For example, in the illustrated scenario the block B would have three confirmation even though tx could be excluded by posting a single block containing a transaction conflicting tx pointing only at C.
![](kip-0005-1.png)
2. It does not take into account visible conflicts. For example, consider the following scenario and say that B' contains a transaction conflicting tx. The block B is a selected chain block so it precedes B'. B has four confirmations whereas B' only has two. However, a single block pointing only at C' can reorg the chain so that B' is in the selected chain and B is invalid.
![](kip-0005-2.png)

It should be noted that these issues are not severe as they might seem. Counting confirmations is similar to the confirmations in Bitcoin, where only the heaviest chain is considered, and a transaction is deemed say after e.g. four confirmations even if the network is aware of a competing chain only one block short that would revert the transaction.

However, the inclusive nature of Kaspa allows us to produce better confidence metrics against double-spend attacks. I propose a metric called *confidence* that roughly measures how many seconds of a 51% attack are required to revert the transaction. I argue that this measure should become the standard metric for how confirmed a block is, and the ecosphere (in particular block explorers and wallet GUIs) should be adjusted accordingly.

# Defining and computing confidence
The confidence of txn is defined as bc/BPS where bc is the number of blocks required to revert txn assuming that:
1. the adversary always wins ties
2. the difficulty is constant



# Interpreting confidence

# Confidence vs. confirmation count

# Why not use blue work?

# Backwards compatibility
Does not affect consensus or other API calls.
